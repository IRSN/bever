<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="bever">
<title>The bever Package User Guide • bever</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The bever Package User Guide">
<meta property="og:description" content="bever">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">bever</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/User.html">The bever Package User Guide</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>The bever Package User Guide</h1>
                        <h4 data-toc-skip class="author">Yves
Deville</h4>
            
            <h4 data-toc-skip class="date">2023-12-28</h4>
      
      
      <div class="d-none name"><code>User.Rmd</code></div>
    </div>

    
    
<p>This document was created with <strong>bever</strong>
<strong>0.1.4</strong> and <strong>potomax</strong>
<strong>0.2.4</strong>. As is the case for the whole package, this
vignette is to be considered as a DRAFT version that still needs,
checking, renaming, …</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3">
<h3 id="goals">Goals<a class="anchor" aria-label="anchor" href="#goals"></a>
</h3>
<p>The package <strong>bever</strong> is devoted to Extreme-Value models
considered from the Bayesian perspective. It depends on the
<strong>potomax</strong> package which consider the same models from a
frequentist perspective with emphasis on the Maximum-Likelihood (ML)
approach. So the two perspectives can be compared by using the same data
and by producing similar results such as the classical Return-Level
plots. So <strong>bever</strong> aims at producing these graphics and
diagnostics. Although the package contains some functions dedicated to
the estimation and inference of these Bayesian models, the results can
also be produced by using Markov Chain Monte-Carlo with different R
packages or even by using a sampling engine such as
<strong>JAGS</strong> or <strong>stan</strong>. <strong>bever</strong>
will then essentially retain the MCMC iterates.</p>
</div>
<div class="section level3">
<h3 id="extreme-value-models">Extreme-Value Models<a class="anchor" aria-label="anchor" href="#extreme-value-models"></a>
</h3>
<p>The package focuses on four types of Extreme-Value models,
conveniently represented by an acronym (or abbreviated names) as
follows.</p>
<ol style="list-style-type: decimal">
<li><p><code>"GEV"</code> <strong>GEV model</strong> or Block Maxima.
The parameters are: <span class="math inline">\(\mu^\star\)</span>
(location), <span class="math inline">\(\sigma^\star\)</span> (scale)
and <span class="math inline">\(\xi^\star\)</span> (shape). The blocks
are assumed to have a constant known duration.</p></li>
<li><p><code>"OS"</code> models for <strong><span class="math inline">\(r\)</span>-largest order statistics</strong> in
blocks. The parameters are the GEV parameters <span class="math inline">\(\mu^\star\)</span>, <span class="math inline">\(\sigma^\star\)</span>, <span class="math inline">\(\xi^\star\)</span> as for block maxima, in
reference with a constant block duration.</p></li>
<li><p><code>"PP"</code> <strong>Point-Process model</strong> for Peaks
Over Threshold (POT). The parameters are GEV parameters <span class="math inline">\(\mu^\star\)</span>, <span class="math inline">\(\sigma^\star\)</span>, <span class="math inline">\(\xi^\star\)</span> for a reference block duration.
This model is fitted by using observations exceeding a given high
threshold <span class="math inline">\(u\)</span>. The parameters do not
depend on <span class="math inline">\(u\)</span> and the support of the
distribution includes values that are <span class="math inline">\(&lt;u\)</span>.</p></li>
<li><p><code>"poisGP"</code> <strong>Poisson-GP model</strong> for POT.
This model describes observations exceeding a given high threshold <span class="math inline">\(u\)</span>. The parameters are: the rate <span class="math inline">\(\lambda\)</span> for the Poisson process of
exceedances and the two parameters: <span class="math inline">\(\sigma\)</span> (scale) and <span class="math inline">\(\xi\)</span> (shape) for the Generalised Pareto
(GP) distribution of the excesses over the given threshold.</p></li>
</ol>
<p>In a first stage at least, the functions and methods are devoted in
priority to the <code>"GEV"</code> and <code>"poisGP"</code> models.</p>
<p>The acronyms as used with the package will be case-insensitive, so
<code>"pp"</code> and <code>"PP"</code> can be indifferently used for
the Point-Process model of 3. So the model types are consistent with
<strong>revbayes</strong>, although <code>"poisGP"</code> is not (yet)
implemented in this package which uses instead the the binomial-GP model
<code>"binGP"</code>.</p>
<p>Speaking of “models” as we did is somewhat abusive because the
Point-Process or Poisson-GP models lead to the GEV block maxima model
when they are aggregated in time, while the Block-Maxima or the Order
Statistics models do not fully describe the extreme observations
occurring within the blocks. These two later models do not provide a
data generation process. We will consider the <code>"GEV"</code> and
<code>"OS"</code> models as derived from a Poisson-GP process, either in
its <code>"PP"</code> or in its <code>"poisGP"</code> parameterisation.
Indeed, we could consider <code>"GEV"</code> and “<code>OS"</code>
models as resulting form a temporal aggregation from a POT model as
implemented in the <code>Renouv</code> function of
<strong>Renext</strong>. As a major difference between <code>"PP"</code>
and <code>"poisGP"</code>, the parameters of <code>"poisGP"</code>
relate to the threshold <span class="math inline">\(u\)</span>, while
those of <code>"PP"</code> do not. Of course, while the
<code>"PP"</code> parameter vector <span class="math inline">\([\mu^\star, \sigma^\star, \xi^\star]\)</span> do
not depend on the threshold <span class="math inline">\(u\)</span>, its
estimate <span class="math inline">\([\widehat{\mu}^\star,
\widehat{\sigma}^\star, \widehat{\xi}^\star]\)</span> does depend on
<span class="math inline">\(u\)</span> which controls the censoring of
the observations. However it is that the estimate remains quite stable
when the threshold is high enough and when there remains enough
data.</p>
<p>The models above will in this vignette be considered both from a
frequentist and from a Bayesian perspective. In the second case, the
inference will generally be based on Markov Chain Monte-Carlo
(MCMC).</p>
</div>
<div class="section level3">
<h3 id="fitted-models-as-s3-classes">Fitted models as S3 classes<a class="anchor" aria-label="anchor" href="#fitted-models-as-s3-classes"></a>
</h3>
<div class="section level4">
<h4 id="classical-fitted-model-objects">Classical “fitted model” objects<a class="anchor" aria-label="anchor" href="#classical-fitted-model-objects"></a>
</h4>
<p>Following a vague terminology making sense at least for R users, we
may call <em>fitted models</em> the results of estimation and inference
for a specific couple <em>model</em> and <em>data</em>. The archetype
would be the (fitted) linear model with the <code>"lm"</code> S3 class.
A very common way to use a specific type of model in R consists in first
creating an object by using the corresponding <em>constructor
function</em>, to which the data are passed as formal argument(s). Then
S3 methods such as <code>plot</code>, <code>summary</code>,
<code>coef</code> are used. The name of constructor function is often
chosen identical to the name of the S3 class: an object with class
<code>"lm"</code> is created by using the <code>lm</code> function.</p>
</div>
<div class="section level4">
<h4 id="poor-mans-posteriors">“Poor Man’s” Posteriors<a class="anchor" aria-label="anchor" href="#poor-mans-posteriors"></a>
</h4>
<p>While these “gentleman’s rules” are retained in the package, we will
in some cases allow the user to create fitted models objects by using
results arising from other packages, as opposed to the usual fitting
from data. For Bayesian fitted models, we will allow to create these
from a matrix of MCMC iterates as produced by other packages, possibly
relying on sampling engines such as <strong>JAGS</strong> or
<strong>stan</strong>. Doing so, the user is responsible for keeping
track of the specific data that were used, these being no longer
automatically duplicated into the fitted model object. However for each
of the models defined above, there is a <em>minimal set of
information</em> which must be given to allow the use of the model
e.g. to derive predictions. Depending on the type of model, this
involves: the <em>block duration</em>, the <em>observation duration</em>
and possibly the <em>threshold</em>. The following table tells if an
information is needed (Y) or not (N) depending on the type of object
created.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Model</th>
<th align="center">Block duration</th>
<th align="center">Obs. duration</th>
<th align="center">Threshold</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>GEV</code></td>
<td align="center">Yes</td>
<td align="center">(# blocks)</td>
<td align="center">No</td>
</tr>
<tr class="even">
<td align="left"><code>OS</code></td>
<td align="center">Yes</td>
<td align="center">(# blocks)</td>
<td align="center">No</td>
</tr>
<tr class="odd">
<td align="left"><code>poisGP</code></td>
<td align="center">No</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
</tr>
<tr class="even">
<td align="left"><code>PP</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
</tr>
</tbody>
</table>
<p>We can call an objects created from MCMC iterates <em>minimalist</em>
or <em>poor man</em>’s posteriors. As shown later, they actually contain
very little more than what can be guessed from the matrix given in
<code>MCMC</code>.</p>
<p>While a fitted model should in principle embed a copy of all the
information used for the fit - including the data, this assumption is
likely to be over-demanding as far as we are interested in by-products
such as graphics or diagnostics. So the creator functions for “poor
man’s posteriors” will use several optional arguments.</p>
<p>The current version focuses on <em>only two EV models</em>: GEV and
Poisson-GP, and provides the following objects</p>
<table class="table">
<thead><tr class="header">
<th align="left">Model</th>
<th align="center">Bayes from data</th>
<th align="center">Bayes from MCMC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">GEV</td>
<td align="center"></td>
<td align="center"><code>GEVBayes0</code></td>
</tr>
<tr class="even">
<td align="left">Poisson-GP</td>
<td align="center"><code>poisGPBayes</code></td>
<td align="center"><code>poisGPBayes0</code></td>
</tr>
</tbody>
</table>
<p>So the convention is (for now) that “from MCMC” objects have names
ending by <code>0</code> to suggest an impoverishment relative to the
classical object. Note for the GEV model only the “from MCMC” option is
available.</p>
<p>The motivate the use of Poor Man’s Posterior (PMP), we can be
interested in drawing a Return-Level plot (RL plot) from a fitted
models, without caring for whether historical information was used or
not. The base ingredient to create a PMP is <em>a matrix</em> say
<code>MCMC</code> containing the MCMC iterates.</p>
</div>
<div class="section level4">
<h4 id="creating-poor-mans-posteriors">Creating Poor Man’s Posteriors<a class="anchor" aria-label="anchor" href="#creating-poor-mans-posteriors"></a>
</h4>
<p>The base ingredient to create a PMP is <em>a matrix</em> say
<code>MCMC</code> containing the MCMC iterates.</p>
<ul>
<li><p>Except in very special cases where the posterior contains
independent components, <em>the columns of <code>MCMC</code> should
correspond to the parnames of the target model</em>.</p></li>
<li><p>The <em>required information pieces</em> for the model should be
given, see above.</p></li>
</ul>
<p>For instance for a GEV model, the matrix <code>MCMC</code> must have
three columns with suitable names; the block duration must be provided.
The observation duration is not required but can be given. We can
further give the observations which would allow display them on the RL
plot. The allowed column names are
<code>c("loc", "scale", "shape")</code> as in several packages like
<strong>evd</strong> or <code>c("mu", "sigma", "xi")</code> as in
<strong>revdbayes</strong>.</p>
</div>
<div class="section level4">
<h4 id="illustration-gev-model-for-portpirie">Illustration: GEV model for <code>portpirie</code><a class="anchor" aria-label="anchor" href="#illustration-gev-model-for-portpirie"></a>
</h4>
<p>Consider first fitting a GEV model for the <code>portpirie</code>
data from <strong>revdbayes</strong>. We define a prior that can be used
with the <code>"gev"</code> model</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">priorGEV1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulnorthrop.github.io/revdbayes/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"flatflat"</span>, model <span class="op">=</span> <span class="st">"gev"</span><span class="op">)</span></span>
<span><span class="va">postGEV1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulnorthrop.github.io/revdbayes/reference/rpost_rcpp.html" class="external-link">rpost_rcpp</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10000</span>, model <span class="op">=</span> <span class="st">"gev"</span>, prior <span class="op">=</span> <span class="va">priorGEV1</span>, data <span class="op">=</span> <span class="va">portpirie</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">postGEV1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "evpost"</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">postGEV1</span><span class="op">$</span><span class="va">sim_vals</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            mu     sigma          xi</span></span>
<span><span class="co">## [1,] 3.872160 0.1798392 -0.01526768</span></span>
<span><span class="co">## [2,] 3.918301 0.2433903 -0.13266764</span></span>
<span><span class="co">## [3,] 3.860427 0.1995496 -0.03745405</span></span></code></pre>
<p>The MCMC iterates are stored in the <code>sim_vals</code> element of
the posterior object. Using <em>this information only</em>, we can
create a Poor Man’s Posterior.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">postGEV0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEVBayes0.html">GEVBayes0</a></span><span class="op">(</span>MCMC <span class="op">=</span> <span class="va">postGEV1</span><span class="op">$</span><span class="va">sim_vals</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">postGEV0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "GEVBayes0" "Bayes0"</span></span></code></pre>
<p>So the object <code>postGEV0</code> inherits from a class named
<code>"Bayes0"</code> containing minimalist Bayesian objects. As its
names suggests, the sub-class <code>GEVBayes0</code> is devoted to GEV
models.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">postGEV0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## GEV Model Bayesian Inference</span></span>
<span><span class="co">## o Block duration : 1</span></span>
<span><span class="co">## o Number of blocks used: 0</span></span>
<span><span class="co">## o Number of MCMC iterates: 10000</span></span>
<span><span class="co">## o Posterior mean [sd]:</span></span>
<span><span class="co">##            loc          scale          shape </span></span>
<span><span class="co">##  3.874 [0.029]  0.207 [0.022] -0.032 [0.102]</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">postGEV0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             loc     scale       shape</span></span>
<span><span class="co">## mean   3.874290 0.2067213 -0.03223860</span></span>
<span><span class="co">## median 3.874141 0.2051367 -0.03795394</span></span>
<span><span class="co">## mode         NA        NA          NA</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">postGEV0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 loc         scale         shape</span></span>
<span><span class="co">## loc    0.0008335293  0.0001948684 -0.0009971168</span></span>
<span><span class="co">## scale  0.0001948684  0.0004715341 -0.0006951623</span></span>
<span><span class="co">## shape -0.0009971168 -0.0006951623  0.0103122562</span></span></code></pre>
<p>Note that the parameters have been renamed: while
<strong>revdbayes</strong> uses <code>mu</code>, <code>sigma</code> and
<code>xi</code>, the corresponding parameters are now named:
<code>loc</code>, <code>scale</code> and <code>shape</code> which better
conforms to older EV packages. Note also that the block duration was by
default considered as begin <code>1.0</code>.</p>
<p>The <code>coef</code> method can be used to extract estimates of the
parameters. Several estimates can be computed from the <code>MCMC</code>
matrix given: posterior mean, median of mode (MAP). The posterior mode
was not displayed here nor computed because it is better to compute it
by maximising the posterior function, but this function can not be
retrieved from the MCMC iterates. The <code>GEVBayes0</code> function
has a <code>MAP</code> formal argument that can be used to pass the MAP
vector when available. This MAP will then be stored in the
<code>GEVBayes0</code> object and it can later be used e.g. to build RL
plots.</p>
<p>It should be noted that by using “MAP”, we generally name the
<em>joint mode</em> and not the <em>vector of marginal modes</em>. By
contrast, the median in <code>coef</code> is a vector of
<em>marginal</em> medians, and not a multivariate median. For the mean
there is no difference between <em>joint</em> an <em>marginal</em>.</p>
<p><span class="math display">\[
\color{red}{\text{XXX Maybe change something in the package about Bayes
              coef?}}
\]</span></p>
<p>We could call an object such as <code>postGEV0</code> a
<em>minimalist</em> or <em>poor man</em> s posterior. It actually
contains very little more than what can be guessed from the matrix given
in <code>MCMC</code>.</p>
</div>
<div class="section level4">
<h4 id="illustration-poisson-gp-model-for-the-rainfall-data">Illustration: Poisson-GP model for the <code>rainfall</code>
data<a class="anchor" aria-label="anchor" href="#illustration-poisson-gp-model-for-the-rainfall-data"></a>
</h4>
<p>The creation of a Poor Man’s Posterior for a Poisson-GP model is a
bit more tedious, mainly because this model is not very popular in the
existing packages and especially not in <strong>revdbayes</strong> which
favours the Binomial-GP model. Assuming that the rate <span class="math inline">\(\lambda\)</span> and the GP parameter <span class="math inline">\([\sigma,\, \xi]\)</span> are a priori independent,
these will remain a posteriori independent as long as ordinary data only
are used.</p>
<p>We begin by retrieving the GP part of the posterior</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rainfall</span><span class="op">)</span></span>
<span><span class="va">rainfall2</span> <span class="op">&lt;-</span> <span class="va">rainfall</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">rainfall</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">u</span> <span class="op">&lt;-</span> <span class="fl">40</span>  <span class="co">## threshold (mm)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fl">57</span>  <span class="co">## obs duration (year)</span></span>
<span><span class="va">nOT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rainfall2</span> <span class="op">&gt;</span> <span class="va">u</span><span class="op">)</span></span>
<span><span class="va">nSim</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">priorGP1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulnorthrop.github.io/revdbayes/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"flatflat"</span>, model <span class="op">=</span> <span class="st">"gp"</span><span class="op">)</span></span>
<span><span class="va">postGP1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulnorthrop.github.io/revdbayes/reference/rpost_rcpp.html" class="external-link">rpost_rcpp</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nSim</span>, model <span class="op">=</span> <span class="st">"gp"</span>, prior <span class="op">=</span> <span class="va">priorGP1</span>,</span>
<span>                      data <span class="op">=</span> <span class="va">rainfall2</span>, thresh <span class="op">=</span> <span class="va">u</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">postGP1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "evpost"</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">postGP1</span><span class="op">$</span><span class="va">sim_vals</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       sigma[u]        xi</span></span>
<span><span class="co">## [1,]  8.357608 0.2448573</span></span>
<span><span class="co">## [2,] 10.112877 0.2418278</span></span>
<span><span class="co">## [3,]  8.191163 0.1370155</span></span></code></pre>
<p>To get MCMC iterates for the rate <span class="math inline">\(\lambda\)</span> of the Poisson process of
exceedances, we simply assume that a conjugate gamma prior is used,
resulting in a gamma posterior from which we can easily simulate.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MCMCpoisGP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">nSim</span>, shape <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">nOT</span>, rate <span class="op">=</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">w</span><span class="op">)</span>,</span>
<span>                    <span class="va">postGP1</span><span class="op">$</span><span class="va">sim_vals</span><span class="op">)</span></span>
<span><span class="va">postGP0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poisGPBayes0.html">poisGPBayes0</a></span><span class="op">(</span>MCMC <span class="op">=</span> <span class="va">MCMCpoisGP</span>, threshold <span class="op">=</span> <span class="va">u</span>, effDuration <span class="op">=</span> <span class="va">w</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">postGP0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## poisGP Model Bayesian Inference</span></span>
<span><span class="co">## o Number of OT observations: NA</span></span>
<span><span class="co">## o Number of MCMC iterates: 10000</span></span>
<span><span class="co">## o Posterior mean [sd]:</span></span>
<span><span class="co">##     lambda      scale      shape </span></span>
<span><span class="co">## 1.5 [0.16] 8.0 [1.27] 0.2 [0.13]</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">postGP0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          lambda    scale     shape</span></span>
<span><span class="co">## mean   1.521839 7.975874 0.1953711</span></span>
<span><span class="co">## median 1.515396 7.900761 0.1802232</span></span>
<span><span class="co">## mode         NA       NA        NA</span></span></code></pre>
<p>Since the difficult part of the posterior is the “GP” part, the
<code>poisGPBayes0</code> function allows the use of a MCMC argument
corresponding to a matrix with only two columns corresponding to the
MCMC iterates for the GP parameter. In this case we have to provide the
number of exceedances by using the <code>nOT</code> format argument,
because this number is needed to determine the (gamma) posterior.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">postGP0b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poisGPBayes0.html">poisGPBayes0</a></span><span class="op">(</span>MCMC <span class="op">=</span> <span class="va">postGP1</span><span class="op">$</span><span class="va">sim_vals</span>, threshold <span class="op">=</span> <span class="va">u</span>,</span>
<span>                         effDuration <span class="op">=</span> <span class="va">w</span>, nOT <span class="op">=</span> <span class="va">nOT</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">postGP0b</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## poisGP Model Bayesian Inference</span></span>
<span><span class="co">## o Number of OT observations: 86</span></span>
<span><span class="co">## o Number of MCMC iterates: 10000</span></span>
<span><span class="co">## o Posterior mean [sd]:</span></span>
<span><span class="co">##     lambda      scale      shape </span></span>
<span><span class="co">## 1.5 [0.16] 8.0 [1.27] 0.2 [0.13] </span></span>
<span><span class="co">## 'lambda' and the GP parameter are a posteriori independent</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">postGP0b</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          lambda    scale     shape</span></span>
<span><span class="co">## mean   1.526316 7.975874 0.1953711</span></span>
<span><span class="co">## median 1.520472 7.900761 0.1802232</span></span>
<span><span class="co">## mode   1.508772       NA        NA</span></span></code></pre>
<p>Note that the estimates for the GP part are <em>exactly</em> the same
as before because they are based on the same MCMC iterates, while the
estimate for the rate are slightly different because they no longer rely
on MCMC iterates but rather on the <em>exact</em> marginal posterior for
<span class="math inline">\(\lambda\)</span>.</p>
</div>
<div class="section level4">
<h4 id="note-on-poor-mans-posteriors-bayes0">Note on Poor Man’s Posteriors <code>*Bayes0</code><a class="anchor" aria-label="anchor" href="#note-on-poor-mans-posteriors-bayes0"></a>
</h4>
<p>Remind that the parameters of the EV models considered in
<strong>bever</strong> relate to the GEV distribution, except for the
Poisson-GP model for which <span class="math inline">\(\sigma\)</span>
and <span class="math inline">\(\xi\)</span> are the scale and the shape
parameter of the Generalised Pareto Distribution.</p>
<p>In this package, we use the convention that the parameters of the GPD
and GEV distributions are named : <code>"loc"</code>,
<code>"scale"</code> and <code>"shape"</code>. This conforms to the rule
used in <strong>Renext</strong> and in classical EV packages such as
<strong>evd</strong>, <strong>ismev</strong> or
<strong>extRemes</strong>. The rate of the Poisson process in the
Poisson-GP model is named <code>"lambda"</code>. Again, this conforms to
the rule used in <strong>Renext</strong>.</p>
<p>Since the <strong>bever</strong> package aims at “importing” MCMC
iterates from other R packages or software tools, it strives to
understand several naming rules. For instance the parameter names used
by <strong>revdbayes</strong> will be automatically translated into the
names retained above. We believe that this strategy is unlikely to
result into a misinterpretation of the parameters: it seems unlikely
that a GEV shape parameter could be named <code>"sigma"</code> or
<code>"mu"</code>. In case of doubt, the user will have to rename the
columns of her MCMC matrices.</p>
<p><strong>CAUTION</strong> For now no extensive tests have been made to
asses a possible change of the order of the parameters.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="bayes-frameworks-priors-and-posteriors">Bayes frameworks: priors and posteriors<a class="anchor" aria-label="anchor" href="#bayes-frameworks-priors-and-posteriors"></a>
</h2>
<p>The models or parameterisations described above can be used in a
Bayesian framework. Here are some details.</p>
<div class="section level3">
<h3 id="poisson-gp-framework">Poisson-GP framework<a class="anchor" aria-label="anchor" href="#poisson-gp-framework"></a>
</h3>
<p>For the Poisson-GP model, some priors can be regarded as favourable.
We will consider the prior based on the two following assumptions</p>
<ul>
<li><p>The rate <span class="math inline">\(\lambda\)</span> and the GP
parameter <span class="math inline">\([\sigma, \, \xi]\)</span> are a
priori independent.</p></li>
<li><p>The rate is a priori Gamma with shape <span class="math inline">\(a_0&gt;0\)</span> and rate <span class="math inline">\(b_0 \geqslant 0\)</span>.</p></li>
</ul>
<p>The case <span class="math inline">\(b_0= 0\)</span> corresponds to
an improper prior <span class="math inline">\(\pi(\lambda) \propto
\lambda^{a_0-1}\)</span> which can make sense at least for <span class="math inline">\(0 &lt; a_0 \leqslant 1\)</span>. The special case
<span class="math inline">\(a_0 = 1\)</span> corresponds to constant
prior density for <span class="math inline">\(\lambda\)</span> i.e. to
an improper uniform distribution on the support <span class="math inline">\((0,\,\infty[\)</span>.</p>
<p><em>Inasmuch only ordinary “OT” observations are used</em>, the
posterior is characterised by the following two properties.</p>
<ul>
<li><p>The rate <span class="math inline">\(\lambda\)</span> and the GP
parameter <span class="math inline">\(\boldsymbol{\theta}_{\text{GP}} :=
[\sigma, \, \xi]\)</span> are a posteriori independent.</p></li>
<li><p>The rate is a priori Gamma with shape <span class="math inline">\(a_n = a_0 +n\)</span> and rate <span class="math inline">\(b_n = b_0 + w\)</span> where <span class="math inline">\(n\)</span> is the number of exceedances and <span class="math inline">\(w\)</span> is the duration of the observation
period.</p></li>
</ul>
<p>However it should be kept in mind that the assumptions on the prior
are relative to the threshold <span class="math inline">\(u\)</span>: if
these assumptions hold for a threshold <span class="math inline">\(u\)</span>, they no longer hold for a threshold
<span class="math inline">\(u' &gt; u\)</span>. Since the threshold
<span class="math inline">\(u\)</span> is generally not known and has to
be chosen empirically, the assumptions on the prior should be regarded
as a trick to reach some computing simplifications and not as a
theoretically well-founded rule.</p>
</div>
<div class="section level3">
<h3 id="other-frameworks">Other frameworks<a class="anchor" aria-label="anchor" href="#other-frameworks"></a>
</h3>
<p>For the other frameworks <code>GEV</code>, <code>rLOS</code> and
<code>PP</code> the priors are for the vector <span class="math inline">\([\mu^\star,\,\sigma^\star,\,\xi^\star]\)</span> of
GEV parameters in relation with a specific block duration <span class="math inline">\(w_{\text{block}}\)</span>, usually taken as one
year. Some specific priors are available in the
<strong>revdbayes</strong> package.</p>
</div>
</div>
<div class="section level2">
<h2 id="return-level-plots">Return level plots<a class="anchor" aria-label="anchor" href="#return-level-plots"></a>
</h2>
<div class="section level3">
<h3 id="classical-return-level-plots-frequentist-or-bayesian">Classical Return Level plots: frequentist or Bayesian<a class="anchor" aria-label="anchor" href="#classical-return-level-plots-frequentist-or-bayesian"></a>
</h3>
<div class="section level4">
<h4 id="displayed-elements">Displayed elements<a class="anchor" aria-label="anchor" href="#displayed-elements"></a>
</h4>
<p>This plot uses a time period <span class="math inline">\(T\)</span>
as abscissa and a quantile as ordinate. The shown elements can be as
follows.</p>
<ul>
<li><p>A point estimate of the return level <span class="math inline">\(\rho(T)\)</span> for a running period <span class="math inline">\(T\)</span> can be displayed as a curve. In the
frequentist framework, the <em>ML estimate</em> <span class="math inline">\(\widehat{\rho}(T)\)</span> will usually be shown.
In the Bayesian framework, the <em>mode</em> (MAP), the <em>median</em>
and the <em>mean</em> of the posterior distribution for <span class="math inline">\(\rho(T)\)</span> can be used.</p></li>
<li><p>The uncertainty on the estimates are can be shown by using
confidence intervals on <span class="math inline">\(\rho(T)\)</span> in
the frequentist framework, or credible intervals on <span class="math inline">\(\rho(T)\)</span> in the Bayesian
framework.</p></li>
<li><p>Finally we can display the observations used in the fit as
“sample” points. This involves the use of suitable <em>plotting
positions</em>.</p></li>
</ul>
<p>When using <strong>bever</strong>, this plot will be obtained by
first calling the <code>RL</code> method, then the <code>autoplot</code>
method on the result which was produced by <code>RL</code>. The
<code>autoplot</code> method produces a ggplot graphics object that can
be modified. The three graphical elements above described correspond to
layers of the <code>ggplot</code> object.</p>
</div>
<div class="section level4">
<h4 id="illustration-for-poisson-gp-fitted-models">Illustration for Poisson-GP fitted models<a class="anchor" aria-label="anchor" href="#illustration-for-poisson-gp-fitted-models"></a>
</h4>
<p>Consider first a frequentist fit using Garonne data from
<strong>Renext</strong>. Since we aim at profile-likelihood inference on
the return levels rather than the delta method, we will use the
<code>protomax::poisGP</code> function to fit a frequentist Poisson-GP
model</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://irsn.github.io/bever/">bever</a></span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">OTdata</span><span class="op">$</span><span class="va">Flow</span></span>
<span><span class="va">u</span> <span class="op">&lt;-</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">OTinfo</span><span class="op">$</span><span class="va">threshold</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">OTinfo</span><span class="op">$</span><span class="va">effDuration</span></span>
<span><span class="va">gfitML</span> <span class="op">&lt;-</span> <span class="fu">potomax</span><span class="fu">::</span><span class="fu"><a href="https://irsn.github.io/potomax/reference/poisGP.html" class="external-link">poisGP</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">y</span>, threshold <span class="op">=</span> <span class="va">u</span>, effDuration <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in potomax::poisGP(data = y, threshold = u, effDuration = w):</span></span>
<span><span class="co">## 'threshold' is smaller than the smallest observation</span></span></code></pre>
<pre><code><span><span class="co">## Warning in threshData(threshold = threshold, data, exceed = TRUE, scale =</span></span>
<span><span class="co">## scale, : 'threshold' is smaller than the smallest observation</span></span></code></pre>
<pre><code><span><span class="co">## Warning in threshData(data, threshold = threshold, exceed = FALSE, scale =</span></span>
<span><span class="co">## FALSE): 'threshold' is smaller than the smallest observation</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">gfitML</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "poisGP"</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">gfitML</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       lambda        scale        shape </span></span>
<span><span class="co">##    2.3230769 1241.4173797   -0.1362312</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">gfitML</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## , , 95%</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##              L        U</span></span>
<span><span class="co">## lambda   1.972    2.714</span></span>
<span><span class="co">## scale  988.964 1538.694</span></span>
<span><span class="co">## shape   -0.209    0.045</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">gfitML</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Fitted Poisson-GP model for \"Garonne\""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/GaronneML-1.png" width="576"></p>
<p>The <code>autoplot</code> S3 method produces a RL plot as a
<strong>ggplot2</strong> graphics. The method used here is for the class
<code>"poisGP"</code>. Note that it is easy to add or overwrite
annotations, labels, …</p>
<p>The RL plot is similar to the one that would be obtained with
<strong>Renext</strong> but the confidence intervals are here obtained
by profile-likelihood and not by the delta method. These intervals are
usually asymmetric, and the Upper bound is usually larger than that
obtained by the delta method.</p>
<p>The <code>RL</code> method can be used to compute the return levels
frm an object with class “<code>poisGP</code>”. This method then returns
an object inheriting from the <code>"data.frame"</code> class which can
again be used with <code>autoplot</code>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gRLML</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://irsn.github.io/potomax/reference/RL.html" class="external-link">RL</a></span><span class="op">(</span><span class="va">gfitML</span>, confintMethod <span class="op">=</span> <span class="st">"proflik"</span>, trace <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">gRLML</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "RL.poisGP"  "data.frame"</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">gRLML</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Period Level    Quant        L        U</span></span>
<span><span class="co">## 14    200   70% 7665.279 7094.007 8654.835</span></span>
<span><span class="co">## 15    250   70% 7783.468 7179.295 8841.809</span></span>
<span><span class="co">## 16    300   70% 7877.404 7245.991 8993.203</span></span>
<span><span class="co">## 17    500   70% 8128.498 7419.502 9410.784</span></span>
<span><span class="co">## 18    700   70% 8284.596 7523.821 9680.573</span></span>
<span><span class="co">## 19   1000   70% 8442.437 7626.501 9962.067</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">gRLML</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Classical RL plot : frequentist POT for Garonne"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/GaronneML_RL1-1.png" width="576"></p>
<p>Now let use compare our frequentist results to those obtained with a
Bayesian analysis of the same data</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gfitBayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poisGPBayes.html">poisGPBayes</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">y</span>, threshold <span class="op">=</span> <span class="va">u</span>, effDuration <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in threshData(threshold = threshold, data = pd, exceed = FALSE):</span></span>
<span><span class="co">## 'threshold' is smaller than the smallest observation</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">gfitBayes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "poisGPBayes"</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">gfitBayes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        lambda    scale      shape</span></span>
<span><span class="co">## mode 2.323256 1239.904 -0.1356296</span></span></code></pre>
<p>By default the Poisson parameter <span class="math inline">\(\lambda\)</span> and the GP parameter <span class="math inline">\([\sigma, \, \xi]\)</span> are assumed a priori
independent and both have a vague prior: the flat gamma prior for <span class="math inline">\(\lambda\)</span> and the <code>"flatflat"</code>
prior of <strong>revdbayes</strong> is used for the GP parameter. The
posterior mode is quite close to the ML estimate.</p>
<p>As for the <code>"poisGP"</code> class the <code>RL</code> method can
be used for the Bayesian objects classes <code>"poisGPBayes"</code> and
<code>"poisGPBayes0"</code></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gRLBayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://irsn.github.io/potomax/reference/RL.html" class="external-link">RL</a></span><span class="op">(</span><span class="va">gfitBayes</span>, trace <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">gRLBayes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "RL.poisGPBayes" "data.frame"</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">gRLBayes</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Period Level     Mode   Median     Mean        L        U</span></span>
<span><span class="co">## 13    200   70% 7667.248 7895.164 8118.091 6988.039 8535.671</span></span>
<span><span class="co">## 14    250   70% 7785.736 8024.689 8269.425 7067.525 8711.142</span></span>
<span><span class="co">## 15    300   70% 7879.921 8131.957 8391.286 7130.567 8855.038</span></span>
<span><span class="co">## 16    500   70% 8131.734 8407.370 8724.639 7287.893 9237.639</span></span>
<span><span class="co">## 17    700   70% 8288.320 8581.924 8938.135 7380.099 9477.636</span></span>
<span><span class="co">## 18   1000   70% 8446.687 8761.017 9159.594 7470.654 9730.077</span></span></code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">gRLBayes</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Classical RL plot : Bayesian POT for Garonne"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/GaronneBayes_RL3-1.png" width="576"></p>
<p>Again the Bayesian RL plot is quite close to the frequentist one: the
modal curve on the Bayesian RL is close to the quantile as estimated by
ML, and the Bayesian credible intervals on quantiles are quite close to
the profile-likelihood confidence interval for the same level (here
<span class="math inline">\(70\%\)</span>), although the limits of the
Bayesian intervals are lower than those of the frequentist ones for
large return periods. Of course, the Bayesian RL plot would be different
if an informative prior had been specified.</p>
<p>Note that for the <span class="math inline">\(x\)</span>-axis we use
a scale which depends on the type of model. For a <code>GEV</code> model
a Gumbel scale should be used because the theoretical RL curve
corresponding to a Gumbel distribution will then show as a straight
line. For POT models either <code>PP</code> or <code>poisGP</code> a
logarithmic scale will be used because the theoretical RL curve
corresponding to an exponential distribution will show as a straight
line.</p>
</div>
<div class="section level4">
<h4 id="illustration-for-gev-models">Illustration for GEV models<a class="anchor" aria-label="anchor" href="#illustration-for-gev-models"></a>
</h4>
<p>We now compare the Bayesian and frequentist classical RL plots for a
GEV model. Since the Bayesian GEV model. We use the
<code>portpirie</code> data as provided by <strong>revdbayes</strong>:
the observations are sea levels at Port Pirie (AU), in metres. The
frequentist inference results and return levels are described in Chap. 3
of Coles’ book <span class="citation">(Coles 2001)</span>.</p>
<p>We begin by fitting the data using ML. For that aim we can use the
<code>poisGP</code> function of the <strong>potomax</strong> package
which can provide the profile-likelihood confidence intervals on the
return levels. Note that since we consider block maxima the
<code>portpirie</code> data must be coerced into a list, and a vector of
effective durations for the blocks must be provided.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://irsn.github.io/potomax/reference/poisGP.html" class="external-link">poisGP</a></span><span class="op">(</span>MAX.data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">portpirie</span><span class="op">)</span>,</span>
<span>               MAX.effDuration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">portpirie</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">fitp</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/portpirieML_RL1-1.png" width="576"></p>
<p>Since the Bayesian GEV model is available “on the shelf” in
<strong>revdbayes</strong>, we will use this package, and then create a
minimal posterior using <code>GEVBayes0</code> from
<strong>bever</strong>. We reproduce here the three lines of code that
were used before.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulnorthrop.github.io/revdbayes/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"flatflat"</span>, model <span class="op">=</span> <span class="st">"gev"</span><span class="op">)</span></span>
<span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulnorthrop.github.io/revdbayes/reference/rpost_rcpp.html" class="external-link">rpost_rcpp</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10000</span>, model <span class="op">=</span> <span class="st">"gev"</span>, prior <span class="op">=</span> <span class="va">prior</span>, data <span class="op">=</span> <span class="va">portpirie</span><span class="op">)</span></span>
<span><span class="va">MAPp</span> <span class="op">&lt;-</span> <span class="va">post</span><span class="op">$</span><span class="va">f_mode</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">MAPp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loc"</span>, <span class="st">"scale"</span>, <span class="st">"shape"</span><span class="op">)</span></span>
<span><span class="va">pfitGEV0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEVBayes0.html">GEVBayes0</a></span><span class="op">(</span>MCMC <span class="op">=</span> <span class="va">post</span><span class="op">$</span><span class="va">sim_vals</span>, yMax <span class="op">=</span> <span class="va">portpirie</span>, MAP <span class="op">=</span> <span class="va">MAPp</span><span class="op">)</span></span></code></pre></div>
<p>Note that the MAP must be given as a <em>named</em> vector with
suitable names.</p>
<p>Then the RL plot is obtained as follows.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">pfitGEV0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Classical RL plot: Bayesian GEV for portpirie"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/portpirieBayes_RL2-1.png" width="576"></p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://irsn.github.io/potomax/reference/RL.html" class="external-link">RL</a></span><span class="op">(</span><span class="va">pfitGEV0</span><span class="op">)</span></span></code></pre></div>
<p>The plot can be compared to the one in Figure 3.5 in Coles’ book
<span class="citation">(Coles 2001)</span>.</p>
<p>It can be seen that the frequentist and Bayesian results are quite
close to each other, although the upper bound of the confidence and
credibe intervals differ for the periods <span class="math inline">\(&gt;100\)</span> years. A quite subtle difference
is that the Bayesian RL plot from <strong>bever</strong> uses a
<em>Gumbel scale</em>, while that of <strong>NSGEV</strong> uses an
<em>exponential scale</em>. The difference is mainly on the region
corresponding to small return periods <span class="math inline">\(T\)</span>, say for <span class="math inline">\(T&lt; 30\)</span>. Note that in order to display
the “sample points”, we have to pass them as vector when creating the
<code>GEVBayes0</code> object, using the <code>yMax</code> argument. We
could have created an object without giving <code>yMax</code> but it
would then no longer have been possible to show the sample points.
Similarly, we could have used the <code>MAP</code> formal argument,
because the MAP is not computed by <code>GEVBayes0</code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="predictive-return-level-plot">Predictive Return Level plot<a class="anchor" aria-label="anchor" href="#predictive-return-level-plot"></a>
</h3>
<div class="section level4">
<h4 id="displayed-elements-1">Displayed elements<a class="anchor" aria-label="anchor" href="#displayed-elements-1"></a>
</h4>
<p>The plot shows the predictive distribution of the maximum <span class="math inline">\(Z^\star\)</span> to be observed in a future or
“new” period with given duration <span class="math inline">\(w^\star\)</span>. More precisely, for some values
of the exceedance probability <span class="math inline">\(p\)</span>, we
show the quantile <span class="math inline">\(z^\star(p)\)</span> of
<span class="math inline">\(Z^\star\)</span> defined by <span class="math inline">\(\text{Pr}\{Z^\star &gt; z^\star(p)\} = p\)</span>.
The duration <span class="math inline">\(w^\star\)</span> is usually
chosen to be one year, but it could be the planned lifetime of an
equipment.</p>
<p>An exceedance probability <span class="math inline">\(p\)</span>
could be associated to the multiple <span class="math inline">\(1/p\)</span> of <span class="math inline">\(w^\star\)</span> hence to a period - e.g. <span class="math inline">\(p=0.001\)</span> relates to the period <span class="math inline">\(1000\, w^\star\)</span>. However, in order to
avoid confusions, <strong>bever</strong> will not use periods as
tickmarks for the <span class="math inline">\(x\)</span>-axis of the
predictive RL plot.</p>
<p>It makes sense to display on a same plot the predictive quantile
curves corresponding to several durations <span class="math inline">\(w^\star_i\)</span>. Remind that by choosing a
smaller the duration <span class="math inline">\(w^\star\)</span> we get
“more conservative” quantiles, when these are compared for a same risk
<span class="math inline">\(p / w^\star\)</span>. For instance a
“millennial risk” could be thought as defined by an exceedance
probability <span class="math inline">\(p_1 = 0.001\)</span> and a
duration <span class="math inline">\(w_1^\star = 1\)</span> year or by
<span class="math inline">\(p_2 = 0.01\)</span> and <span class="math inline">\(w_2^\star = 10\)</span> year. In the later case we
get a smaller quantile.</p>
</div>
<div class="section level4">
<h4 id="illustration-poisson-gp-pot-for-garonne-data">Illustration: Poisson-GP POT for <code>Garonne</code> data<a class="anchor" aria-label="anchor" href="#illustration-poisson-gp-pot-for-garonne-data"></a>
</h4>
<p>When using <strong>bever</strong>, this plot will be obtained by
first calling the standard <code>predict</code> method, then the
<code>autoplot</code> method on the result which was produced by
<code>predict</code>. Again, the <code>autoplot</code> method produces a
ggplot graphics object that can be modified.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gpredBayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">gfitBayes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in poisGPBayes0(MCMC = object$MCMC, threshold = object$threshold, :</span></span>
<span><span class="co">## Since 'data' has class "potData" the formal arguments 'effDuration', 'nOT',</span></span>
<span><span class="co">## 'MAX.*' and 'OTS.*' are ignored</span></span></code></pre>
<pre><code><span><span class="co">## Warning in threshData(threshold = threshold, data = pd, exceed = FALSE):</span></span>
<span><span class="co">## 'threshold' is smaller than the smallest observation</span></span></code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">gpredBayes</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Predictive RL plot : Bayesian POT for Garonne"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/gBayes_predict-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="illustration-gev-model-for-portpirie-1">Illustration: GEV model for <code>portpirie</code><a class="anchor" aria-label="anchor" href="#illustration-gev-model-for-portpirie-1"></a>
</h4>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ppredGEV0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">pfitGEV0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">ppredGEV0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Predictive RL plot : Bayesian GEV for portpirie"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/pBayes_predict-1.png" width="576"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="relations-to-other-packages">Relations to other packages<a class="anchor" aria-label="anchor" href="#relations-to-other-packages"></a>
</h2>
<div class="section level3">
<h3 id="revdbayes">revdbayes<a class="anchor" aria-label="anchor" href="#revdbayes"></a>
</h3>
<p>The <strong>revdbayes</strong> package uses a single S3 class to
represent posterior (or “fitted” versions) for several types of Bayesian
EV models: <code>gev</code>, <code>os</code>, <code>pp</code>,
<code>bingp</code> and more. This class is named <code>"evpost"</code>.
As a difference with most classical R packages there is no eponymous
creator function, and the objects of this class are created using either
the <code>r_post</code> function or the faster-running
<code>r_post_rcpp</code> function. Both these creator functions have
many formal arguments because different types of models are allowed,
depending on the value of the formal named <code>model</code>. An object
of the class <code>"evpost"</code> is essentially a list. Since
different kinds of models can be described, some “slots” or list
elements can be <code>NULL</code>. For instance, the element
<code>threshold</code> will be <code>NULL</code> when the model is
<code>gev</code> or <code>os</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="xxx-questions-on-bever-design">XXX Questions on <strong>bever</strong> design<a class="anchor" aria-label="anchor" href="#xxx-questions-on-bever-design"></a>
</h2>
<ul>
<li><p>What should return the <code>coef</code> method?</p></li>
<li><p>Choose the names of the data arguments to make available the
ideas used in <strong>Renext</strong>. We can fit POT models using “OT”
data, “Max” data and “OTS” data. All three should be optional arguments
of the <code>poisGPML</code> creator, and possibly of its Bayesian
companion <code>poisGPBayes</code>.</p></li>
</ul>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Coles_ExtremeValues" class="csl-entry">
Coles, S. 2001. <em><span class="nocase">An Introduction to Statistical
Modelling of Extreme Values</span></em>. Springer.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Yves Deville.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
